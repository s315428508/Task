<!DOCTYPE html>
<!-- å£°æ˜æ–‡æ¡£ç±»å‹ä¸º HTML5 -->
<html lang="zh-CN">
<!-- è®¾ç½®ç½‘é¡µè¯­è¨€ä¸ºä¸­æ–‡ -->

<head>
    <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸º UTF-8ï¼Œæ”¯æŒä¸­æ–‡ -->
    <meta charset="UTF-8">
    <!-- ç§»åŠ¨ç«¯é€‚é…ï¼šé˜²æ­¢ç¼©æ”¾ï¼Œç¡®ä¿åœ¨æ‰‹æœºä¸Š 1:1 æ˜¾ç¤ºï¼Œviewport-fit=cover é€‚é…åˆ˜æµ·å± -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- ç½‘é¡µæ ‡é¢˜ -->
    <title>æç®€å¾…åŠ</title>
    <!-- è‹¹æœ WebApp å…¨å±æ¨¡å¼ -->
    <link rel="apple-touch-icon" href="logo_v2.png">

    <link rel="apple-touch-icon" sizes="180x180" href="logo_v2.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- è‹¹æœå¯¼èˆªæ æ ·å¼ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <style>
        /* 1. CSS å˜é‡å®šä¹‰ï¼šæ–¹ä¾¿å…¨å±€ä¿®æ”¹ä¸»é¢˜é¢œè‰² */
        :root {
            --bg-color: #f2f2f7;
            /* é¡µé¢èƒŒæ™¯è‰²ï¼ˆæ·¡ç°è‰²ï¼‰ */
            --card-bg: #ffffff;
            /* å¡ç‰‡èƒŒæ™¯è‰²ï¼ˆçº¯ç™½è‰²ï¼‰ */
            --accent-color: #007aff;
            /* å¼ºè°ƒè‰²ï¼ˆiOS è“è‰²ï¼‰ */
        }

        /* 2. å…¨å±€é‡ç½®æ ·å¼ */
        * {
            -webkit-tap-highlight-color: transparent;
            /* å»é™¤ iOS ç‚¹å‡»æ—¶çš„è“è‰²é«˜äº®é˜´å½± */
            box-sizing: border-box;
            /* ç›’æ¨¡å‹ï¼špadding ä¸ä¼šæ’‘å¤§å®¹å™¨å®½åº¦ */
        }

        /* 3. é¡µé¢å¤§ä½“å¸ƒå±€ */
        body {
            font-family: -apple-system, system-ui;
            /* è°ƒç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“ */
            background-color: var(--bg-color);
            /* åº”ç”¨èƒŒæ™¯è‰²å˜é‡ */
            margin: 0;
            /* å»é™¤è¾¹è· */
            height: 100vh;
            /* é«˜åº¦å……æ»¡å±å¹• */
            overflow: hidden;
            /* é˜²æ­¢æ•´ä¸ªé¡µé¢éšé”®ç›˜/å†…å®¹ä¹±ä¹±æ»šåŠ¨ */
            display: flex;
            flex-direction: column;
            /* å‚ç›´å¸ƒå±€ï¼šHeader + åˆ—è¡¨ + åº•éƒ¨æ  */
        }

        /* 4. å¤´éƒ¨æ ‡é¢˜æ ·å¼ */
        header {
            /* padding è®¡ç®—ï¼šå®‰å…¨åŒºåŸŸ(åˆ˜æµ·) + 20px è¾¹è· */
            padding: calc(env(safe-area-inset-top) + 20px) 20px 10px;
            font-size: 32px;
            /* å¤§æ ‡é¢˜ */
            font-weight: 800;
            /* åŠ ç²— */
            background: var(--bg-color);
            position: sticky;
            /* å¸é¡¶æ•ˆæœ */
            top: 0;
            z-index: 100;
            /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
        }

        /* 5. ä»»åŠ¡åˆ—è¡¨å®¹å™¨ */
        .list-container {
            flex: 1;
            /* è‡ªåŠ¨å æ»¡é™¤äº† Header å’Œ Footer çš„ç©ºé—´ */
            overflow-y: auto;
            /* åªæœ‰è¿™ä¸ªåŒºåŸŸå¯ä»¥çºµå‘æ»šåŠ¨ */
            padding: 10px 20px 160px;
            /* åº•éƒ¨ padding å¤§ä¸€ç‚¹ï¼Œé˜²æ­¢è¢«è¾“å…¥æ¡†é®æŒ¡ */
        }

        /* 6. å•ä¸ªä»»åŠ¡å¡ç‰‡æ ·å¼ */
        .task-card {
            background: var(--card-bg);
            padding: 18px;
            border-radius: 14px;
            /* åœ†è§’ */
            margin-bottom: 12px;
            /* å¡ç‰‡é—´è· */
            font-size: 17px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            /* æç»†å¾®é˜´å½± */
            /* å…³é”®ï¼šQ å¼¹ç¼©æ”¾åŠ¨ç”»æ•ˆæœ */
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            user-select: none;
            /* ç¦æ­¢é€‰ä¸­æ–‡æœ¬ï¼Œè®©ç‚¹å‡»æ„Ÿæ›´åƒåŸç”Ÿ App */
        }

        /* 7. å¡ç‰‡æŒ‰ä¸‹æ—¶çš„è§†è§‰åé¦ˆ */
        .task-card:active {
            transform: scale(0.94);
            /* ç¨å¾®ç¼©å° 6% */
            background-color: #f9f9f9;
            /* è‰²è°ƒå˜æš—ä¸€ç‚¹ç‚¹ */
        }

        /* 8. åº•éƒ¨è¾“å…¥åŒºåŸŸå®¹å™¨ */
        .input-area {
            position: fixed;
            /* å›ºå®šåœ¨å±å¹•åº•éƒ¨ä¸Šæ–¹ */
            bottom: 85px;
            /* é¿å¼€æœ€åº•éƒ¨çš„ TabBar */
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: var(--card-bg);
            border-top: 0.5px solid #d1d1d6;
            /* é¡¶éƒ¨åˆ†å‰²çº¿ */
            display: flex;
            z-index: 10;
        }

        /* 9. è¾“å…¥æ¡†æ ·å¼ */
        input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            /* å»é™¤è¾¹æ¡† */
            background: #f2f2f7;
            /* ç°è‰²èƒŒæ™¯ */
            font-size: 16px;
            outline: none;
            /* å»é™¤ç‚¹å‡»æ—¶çš„è“è‰²æ¡† */
        }

        /* 10. åº•éƒ¨å¯¼èˆªæ å®¹å™¨ */
        .tab-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 85px;
            /* iOS æ ‡å‡†åº•éƒ¨æ é«˜åº¦ */
            background: rgba(249, 249, 249, 0.94);
            /* è‹¹æœç»å…¸çš„æ¯›ç»ç’ƒæ•ˆæœèƒŒæ™¯ */
            backdrop-filter: blur(20px);
            /* èƒŒæ™¯æ¨¡ç³Š */
            display: flex;
            padding-bottom: env(safe-area-inset-bottom);
            /* é€‚é…åº•éƒ¨å°æ¨ªæ¡ */
            border-top: 0.5px solid #d1d1d6;
        }

        /* 11. å¯¼èˆªæ å•ä¸ªæŒ‰é’® */
        .tab-item {
            flex: 1;
            /* ç­‰åˆ†ä¸‰ä»½ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            /* æ–‡å­—å¤§å° */
            color: #8e8e93;
            /* é»˜è®¤ç°è‰² */
            gap: 4px;
            /* å›¾æ ‡ä¸æ–‡å­—çš„é—´è· */
        }

        /* 12. å¯¼èˆªæ å›¾æ ‡æ ·å¼ */
        .tab-item b {
            font-size: 20px;
            font-style: normal;
        }

        /* 13. å¯¼èˆªæ æ¿€æ´»çŠ¶æ€æ ·å¼ */
        .tab-item.active {
            color: var(--accent-color);
            /* å˜æˆæ·±è“è‰² */
        }
    </style>
</head>

<body ontouchstart="">
    <!-- ontouchstart="" è§£å†³æ‰‹æœºç«¯ :active ä¼ªç±»å¤±æ•ˆçš„é—®é¢˜ -->

    <!-- é¡¶æ æ ‡é¢˜ -->
    <header id="page-title">å¤‡å¿˜æ¸…å•</header>

    <!-- ä»»åŠ¡å±•ç¤ºåŒºåŸŸï¼ˆç”± JS åŠ¨æ€ç”Ÿæˆå¡ç‰‡æ’å…¥æ­¤å¤„ï¼‰ -->
    <div class="list-container" id="task-list"></div>

    <!-- è¾“å…¥æ¡†åŒºåŸŸ -->
    <div class="input-area" id="input-box">
        <input type="text" id="new-task" placeholder="æ·»åŠ æ–°å¤‡å¿˜..." enterkeyhint="done">
        <!-- enterkeyhint="done" ä½¿æ‰‹æœºé”®ç›˜çš„å›è½¦é”®æ˜¾ç¤ºâ€œå®Œæˆâ€ -->
    </div>

    <!-- åº•éƒ¨åŠŸèƒ½åˆ‡æ¢æ  -->
    <nav class="tab-bar">
        <div class="tab-item active" onclick="switchTab('memo')"><b>ğŸ“</b>å¤‡å¿˜</div>
        <div class="tab-item" onclick="switchTab('doing')"><b>ğŸƒ</b>è¿›è¡Œä¸­</div>
        <div class="tab-item" onclick="switchTab('done')"><b>âœ…</b>å·²å®Œæˆ</div>
    </nav>

    <script>
        /* 1. åˆå§‹åŒ–æ•°æ®ï¼šä»æµè§ˆå™¨ç¼“å­˜è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºæ•°ç»„ */
        let tasks = JSON.parse(localStorage.getItem('my_tasks')) || [];
        /* 2. å½“å‰æ‰€åœ¨çš„æ ‡ç­¾é¡µï¼š'memo'(å¤‡å¿˜), 'doing'(è¿›è¡Œä¸­), 'done'(å·²å®Œæˆ) */
        let currentTab = 'memo';

        /* 3. ä¿å­˜æ•°æ®åˆ°æµè§ˆå™¨ç¼“å­˜ */
        function saveData() {
            localStorage.setItem('my_tasks', JSON.stringify(tasks));
        }

        /* 4. æ¸²æŸ“å‡½æ•°ï¼šæ ¹æ®å½“å‰æ•°æ®å’Œæ ‡ç­¾ï¼Œåˆ·æ–°é¡µé¢æ˜¾ç¤º */
        function render() {
            const list = document.getElementById('task-list');
            const inputArea = document.getElementById('input-box');

            // a. æ›´æ–°æ ‡é¢˜æ–‡å­—
            document.getElementById('page-title').innerText = {
                memo: 'å¤‡å¿˜æ¸…å•',
                doing: 'è¿›è¡Œä¸­',
                done: 'å·²å®Œæˆ'
            }[currentTab];

            // b. åªæœ‰åœ¨â€œå¤‡å¿˜â€æ æ‰æ˜¾ç¤ºè¾“å…¥æ¡†
            inputArea.style.display = currentTab === 'memo' ? 'flex' : 'none';

            // c. è¿‡æ»¤ä»»åŠ¡ï¼šåªæ‰¾å‡ºå±äºå½“å‰çŠ¶æ€ ä¸” å†…å®¹ä¸ä¸ºç©ºçš„ä»»åŠ¡
            const filteredTasks = tasks.filter(t => t.status === currentTab && t.text && t.text.trim() !== "");

            // d. æ˜ å°„ä¸º HTML å­—ç¬¦ä¸²ï¼šæŠŠæ¯ä¸ªä»»åŠ¡å˜æˆä¸€ä¸ª <div class="task-card">...</div>
            list.innerHTML = filteredTasks
                .map(t => `<div class="task-card" onclick="moveTask(${t.id})">${t.text}</div>`)
                .join('');

            // e. æ›´æ–°åº•éƒ¨å¯¼èˆªæ çš„æ¿€æ´»é¢œè‰²ï¼šå¾ªç¯ä¸‰ä¸ª Tabï¼Œå¯¹æ¯” currentTab
            document.querySelectorAll('.tab-item').forEach((el, i) => {
                el.classList.toggle('active', ['memo', 'doing', 'done'][i] === currentTab);
            });
        }

        /* 5. ä»»åŠ¡æµè½¬é€»è¾‘ï¼šç‚¹å‡»å¡ç‰‡åï¼Œæ”¹å˜å…¶çŠ¶æ€ */
        function moveTask(id) {
            // æ‰¾åˆ°è¢«ç‚¹å‡»çš„é‚£ä¸ªä»»åŠ¡å¯¹è±¡
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            // é€»è¾‘ï¼šå¤‡å¿˜ -> è¿›è¡Œä¸­ -> å·²å®Œæˆ -> è¿›è¡Œä¸­ (å¾ªç¯)
            if (currentTab === 'memo') {
                task.status = 'doing';
            } else if (currentTab === 'doing') {
                task.status = 'done';
                task.doneTime = Date.now(); // è®°å½•å®Œæˆæ—¶é—´ï¼Œç”¨äº 3 å¤©åè‡ªåŠ¨æ¸…ç†
            } else if (currentTab === 'done') {
                task.status = 'doing';
                task.doneTime = null;       // å›æ»šåˆ°è¿›è¡Œä¸­ï¼Œæ¸…ç©ºå®Œæˆæ—¶é—´
            }
            saveData(); // ä¿å­˜ä¿®æ”¹
            render();   // åˆ·æ–°ç•Œé¢
        }

        /* 6. åˆ‡æ¢åº•éƒ¨æ ‡ç­¾é¡µ */
        function switchTab(tab) {
            currentTab = tab;
            render();
        }

        /* 7. è¾“å…¥æ¡†å›è½¦ç›‘å¬é€»è¾‘ */
        document.getElementById('new-task').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') { // å¦‚æœæ•²äº†å›è½¦
                const content = e.target.value.trim(); // è·å–å†…å®¹å¹¶å»é™¤ä¸¤ç«¯ç©ºæ ¼
                if (content) {
                    // åœ¨ tasks æ•°ç»„é‡Œæ–°å¢ä¸€ä¸ªä»»åŠ¡å¯¹è±¡
                    tasks.push({
                        id: Date.now(),      // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ ID
                        text: content,       // ä»»åŠ¡æ­£æ–‡
                        status: 'memo',      // åˆå§‹çŠ¶æ€æ˜¯å¤‡å¿˜æ 
                        doneTime: null       // åˆå§‹æ²¡æœ‰å®Œæˆæ—¶é—´
                    });
                    e.target.value = '';    // æ¸…ç©ºè¾“å…¥æ¡†
                    e.target.blur();        // è¾“å…¥æ¡†æ”¶èµ·é”®ç›˜
                    window.scrollTo(0, 0);  // é¡µé¢å›åˆ°é¡¶éƒ¨
                    saveData();
                    render();
                }
            }
        });

        /* 8. è‡ªåŠ¨æ¸…ç†é€»è¾‘ï¼šæ¸…ç† 3 å¤©å‰å·²å®Œæˆçš„ä»»åŠ¡ */
        function autoClean() {
            const threeDays = 3 * 24 * 60 * 60 * 1000; // 3 å¤©çš„æ¯«ç§’æ•°
            const now = Date.now();
            const initialLength = tasks.length;

            // è¿‡æ»¤ï¼šæ’é™¤æ‰ (çŠ¶æ€æ˜¯ done ä¸” è¶…è¿‡ 3 å¤©) çš„ä»»åŠ¡
            tasks = tasks.filter(t => !(t.status === 'done' && t.doneTime && (now - t.doneTime > threeDays)));

            // å¦‚æœæ•°é‡æœ‰å˜åŒ–ï¼Œè¯´æ˜æœ‰ä»»åŠ¡è¢«æ¸…ç†äº†ï¼Œåˆ·æ–°ä¸€æ¬¡
            if (tasks.length !== initialLength) {
                saveData();
                render();
            }
        }

        /* 9. å®šæ—¶å™¨ï¼šæ¯ 1 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦æ¸…ç†æ—§æ•°æ® */
        setInterval(autoClean, 60000);

        /* 10. é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“ */
        render();
    </script>
</body>


</html>
