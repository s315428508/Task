<!DOCTYPE html>
<!-- å£°æ˜æ–‡æ¡£ç±»å‹ä¸º HTML5 -->
<html lang="zh-CN">
<!-- è®¾ç½®ç½‘é¡µè¯­è¨€ä¸ºä¸­æ–‡ -->

<head>
    <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸º UTF-8ï¼Œæ”¯æŒä¸­æ–‡ -->
    <meta charset="UTF-8">
    <!-- ç§»åŠ¨ç«¯é€‚é…ï¼šé˜²æ­¢ç¼©æ”¾ï¼Œç¡®ä¿åœ¨æ‰‹æœºä¸Š 1:1 æ˜¾ç¤ºï¼Œviewport-fit=cover é€‚é…åˆ˜æµ·å± -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- ç½‘é¡µæ ‡é¢˜ -->
    <title>æç®€å¾…åŠ</title>
    <!-- è‹¹æœ WebApp å…¨å±æ¨¡å¼ -->
    <link rel="apple-touch-icon" href="logo.png">

    <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- è‹¹æœå¯¼èˆªæ æ ·å¼ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <style>
        :root {
            /* æµ…è‰²æ¨¡å¼å˜é‡ */
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-color: #000000;
            --accent-color: #007aff;
            --border-color: #d1d1d6;
            --input-bg: #f2f2f7;
        }

        /* æ ¸å¿ƒï¼šè‡ªåŠ¨æ·±è‰²æ¨¡å¼é€‚é… */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #000000;
                /* çº¯é»‘èƒŒæ™¯ï¼Œæ›´çœç”µ */
                --card-bg: #1c1c1e;
                /* æ·±ç°è‰²å¡ç‰‡ */
                --text-color: #ffffff;
                /* ç™½è‰²æ–‡å­— */
                --accent-color: #0a84ff;
                /* äº®è“è‰² */
                --border-color: #38383a;
                /* æ·±è‰²è¾¹æ¡† */
                --input-bg: #2c2c2e;
                /* è¾“å…¥æ¡†èƒŒæ™¯ */
            }
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, system-ui;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
            /* åˆ‡æ¢æ—¶æœ‰å¹³æ»‘è¿‡æ¸¡ */
        }

        header {
            padding: calc(env(safe-area-inset-top) + 20px) 20px 10px;
            font-size: 32px;
            font-weight: 800;
            background: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 20px 160px;
        }

        .task-card {
            background: var(--card-bg);
            color: var(--text-color);
            padding: 18px;
            border-radius: 14px;
            margin-bottom: 12px;
            font-size: 17px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.3s;
            display: flex;
            align-items: center;
        }

        .task-card:active {
            transform: scale(0.94);
            filter: brightness(0.8);
        }

        .input-area {
            position: fixed;
            bottom: 85px;
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: var(--card-bg);
            border-top: 0.5px solid var(--border-color);
            display: flex;
            z-index: 10;
        }

        input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            outline: none;
        }

        .tab-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 85px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            display: flex;
            padding-bottom: env(safe-area-inset-bottom);
            border-top: 0.5px solid var(--border-color);
            opacity: 0.94;
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #8e8e93;
            gap: 4px;
        }

        .tab-item b {
            font-size: 20px;
            font-style: normal;
        }

        .tab-item.active {
            color: var(--accent-color);
        }
    </style>
</head>

<body ontouchstart="">
    <!-- ontouchstart="" è§£å†³æ‰‹æœºç«¯ :active ä¼ªç±»å¤±æ•ˆçš„é—®é¢˜ -->

    <!-- é¡¶æ æ ‡é¢˜ -->
    <header id="page-title">å¤‡å¿˜æ¸…å•</header>

    <!-- ä»»åŠ¡å±•ç¤ºåŒºåŸŸï¼ˆç”± JS åŠ¨æ€ç”Ÿæˆå¡ç‰‡æ’å…¥æ­¤å¤„ï¼‰ -->
    <div class="list-container" id="task-list"></div>

    <!-- è¾“å…¥æ¡†åŒºåŸŸ -->
    <div class="input-area" id="input-box">
        <input type="text" id="new-task" placeholder="æ·»åŠ æ–°å¤‡å¿˜..." enterkeyhint="done">
        <!-- enterkeyhint="done" ä½¿æ‰‹æœºé”®ç›˜çš„å›è½¦é”®æ˜¾ç¤ºâ€œå®Œæˆâ€ -->
    </div>

    <!-- åº•éƒ¨åŠŸèƒ½åˆ‡æ¢æ  -->
    <nav class="tab-bar">
        <div class="tab-item active" onclick="switchTab('memo')"><b>ğŸ“</b>å¤‡å¿˜</div>
        <div class="tab-item" onclick="switchTab('doing')"><b>ğŸƒ</b>è¿›è¡Œä¸­</div>
        <div class="tab-item" onclick="switchTab('done')"><b>âœ…</b>å·²å®Œæˆ</div>
    </nav>

    <script>
        /* 1. åˆå§‹åŒ–æ•°æ®ï¼šä»æµè§ˆå™¨ç¼“å­˜è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºæ•°ç»„ */
        let tasks = JSON.parse(localStorage.getItem('my_tasks')) || [];
        /* 2. å½“å‰æ‰€åœ¨çš„æ ‡ç­¾é¡µï¼š'memo'(å¤‡å¿˜), 'doing'(è¿›è¡Œä¸­), 'done'(å·²å®Œæˆ) */
        let currentTab = 'memo';

        /* 3. ä¿å­˜æ•°æ®åˆ°æµè§ˆå™¨ç¼“å­˜ */
        function saveData() {
            localStorage.setItem('my_tasks', JSON.stringify(tasks));
        }

        /* 4. æ¸²æŸ“å‡½æ•°ï¼šæ ¹æ®å½“å‰æ•°æ®å’Œæ ‡ç­¾ï¼Œåˆ·æ–°é¡µé¢æ˜¾ç¤º */
        function render() {
            const list = document.getElementById('task-list');
            const inputArea = document.getElementById('input-box');

            // a. æ›´æ–°æ ‡é¢˜æ–‡å­—
            document.getElementById('page-title').innerText = {
                memo: 'å¤‡å¿˜æ¸…å•',
                doing: 'è¿›è¡Œä¸­',
                done: 'å·²å®Œæˆ'
            }[currentTab];

            // b. åªæœ‰åœ¨â€œå¤‡å¿˜â€æ æ‰æ˜¾ç¤ºè¾“å…¥æ¡†
            inputArea.style.display = currentTab === 'memo' ? 'flex' : 'none';

            // c. è¿‡æ»¤ä»»åŠ¡ï¼šåªæ‰¾å‡ºå±äºå½“å‰çŠ¶æ€ ä¸” å†…å®¹ä¸ä¸ºç©ºçš„ä»»åŠ¡
            const filteredTasks = tasks.filter(t => t.status === currentTab && t.text && t.text.trim() !== "");

            // d. æ˜ å°„ä¸º HTML å­—ç¬¦ä¸²ï¼šæŠŠæ¯ä¸ªä»»åŠ¡å˜æˆä¸€ä¸ª <div class="task-card">...</div>
            list.innerHTML = filteredTasks
                .map(t => `<div class="task-card" onclick="moveTask(${t.id})">${t.text}</div>`)
                .join('');

            // e. æ›´æ–°åº•éƒ¨å¯¼èˆªæ çš„æ¿€æ´»é¢œè‰²ï¼šå¾ªç¯ä¸‰ä¸ª Tabï¼Œå¯¹æ¯” currentTab
            document.querySelectorAll('.tab-item').forEach((el, i) => {
                el.classList.toggle('active', ['memo', 'doing', 'done'][i] === currentTab);
            });
        }

        /* 5. ä»»åŠ¡æµè½¬é€»è¾‘ï¼šç‚¹å‡»å¡ç‰‡åï¼Œæ”¹å˜å…¶çŠ¶æ€ */
        function moveTask(id) {
            // æ‰¾åˆ°è¢«ç‚¹å‡»çš„é‚£ä¸ªä»»åŠ¡å¯¹è±¡
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            // é€»è¾‘ï¼šå¤‡å¿˜ -> è¿›è¡Œä¸­ -> å·²å®Œæˆ -> è¿›è¡Œä¸­ (å¾ªç¯)
            if (currentTab === 'memo') {
                task.status = 'doing';
            } else if (currentTab === 'doing') {
                task.status = 'done';
                task.doneTime = Date.now(); // è®°å½•å®Œæˆæ—¶é—´ï¼Œç”¨äº 3 å¤©åè‡ªåŠ¨æ¸…ç†
            } else if (currentTab === 'done') {
                task.status = 'doing';
                task.doneTime = null;       // å›æ»šåˆ°è¿›è¡Œä¸­ï¼Œæ¸…ç©ºå®Œæˆæ—¶é—´
            }
            saveData(); // ä¿å­˜ä¿®æ”¹
            render();   // åˆ·æ–°ç•Œé¢
        }

        /* 6. åˆ‡æ¢åº•éƒ¨æ ‡ç­¾é¡µ */
        function switchTab(tab) {
            currentTab = tab;
            render();
        }

        /* 7. è¾“å…¥æ¡†å›è½¦ç›‘å¬é€»è¾‘ */
        document.getElementById('new-task').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') { // å¦‚æœæ•²äº†å›è½¦
                const content = e.target.value.trim(); // è·å–å†…å®¹å¹¶å»é™¤ä¸¤ç«¯ç©ºæ ¼
                if (content) {
                    // åœ¨ tasks æ•°ç»„é‡Œæ–°å¢ä¸€ä¸ªä»»åŠ¡å¯¹è±¡
                    tasks.push({
                        id: Date.now(),      // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ ID
                        text: content,       // ä»»åŠ¡æ­£æ–‡
                        status: 'memo',      // åˆå§‹çŠ¶æ€æ˜¯å¤‡å¿˜æ 
                        doneTime: null       // åˆå§‹æ²¡æœ‰å®Œæˆæ—¶é—´
                    });
                    e.target.value = '';    // æ¸…ç©ºè¾“å…¥æ¡†
                    e.target.blur();        // è¾“å…¥æ¡†æ”¶èµ·é”®ç›˜
                    window.scrollTo(0, 0);  // é¡µé¢å›åˆ°é¡¶éƒ¨
                    saveData();
                    render();
                }
            }
        });

        /* 8. è‡ªåŠ¨æ¸…ç†é€»è¾‘ï¼šæ¸…ç† 3 å¤©å‰å·²å®Œæˆçš„ä»»åŠ¡ */
        function autoClean() {
            const threeDays = 3 * 24 * 60 * 60 * 1000; // 3 å¤©çš„æ¯«ç§’æ•°
            const now = Date.now();
            const initialLength = tasks.length;

            // è¿‡æ»¤ï¼šæ’é™¤æ‰ (çŠ¶æ€æ˜¯ done ä¸” è¶…è¿‡ 3 å¤©) çš„ä»»åŠ¡
            tasks = tasks.filter(t => !(t.status === 'done' && t.doneTime && (now - t.doneTime > threeDays)));

            // å¦‚æœæ•°é‡æœ‰å˜åŒ–ï¼Œè¯´æ˜æœ‰ä»»åŠ¡è¢«æ¸…ç†äº†ï¼Œåˆ·æ–°ä¸€æ¬¡
            if (tasks.length !== initialLength) {
                saveData();
                render();
            }
        }

        /* 9. å®šæ—¶å™¨ï¼šæ¯ 1 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦æ¸…ç†æ—§æ•°æ® */
        setInterval(autoClean, 60000);

        /* 10. é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“ */
        render();
    </script>
</body>

</html>